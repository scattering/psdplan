<html>
<head>
    <title>Neutron Activation Calculator</title>


    <style type="text/css">
        body { font-size: 0.9em; }
        label { font-weight: inherit; }
        .hidden { overflow: hidden; }
        .colborder { margin-bottom: -100%; padding-bottom: 100%; }
        caption, td, th { padding-top: 0, padding-bottom: 0; }
        tbody tr:nth-child(2n) th, tbody tr.even th,
        tbody tr:nth-child(2n) td, tbody tr.even td,
        ul li:nth-child(2n), ol li:nth-child(2n) { background: inherit; /* background: none repeat scroll 0 0 #F3F3F9; */ }
    </style>


    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/themes/start/jquery-ui.css" type="text/css" rel="Stylesheet" />


    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js" type="text/javascript"></script>


    <script type="text/javascript" src="/static/lib/ajaxCSRFfix.js"></script>


    <script type="text/javascript">
        CUTOFF = 0.;
        $(document).ready(function() {
            $("#id-activationForm").submit(function(event){
                event.preventDefault();
                $.ajax({
                    type:"POST",
                    url:"http://sparkle.ncnr.nist.gov:8000/cgibin/nact.py",
                    data: {sample: $('input:text[id=id_chemical_formula]').val(),
                        flux: $('input:text[id=id_flux]').val(),
                        mass: $('input:text[id=id_mass]').val(),
                        exposure: $('input:text[id=id_time_on]').val(),
                        rest: [0,1,24,360,parseFloat($('input:text[id=id_time_off]').val())],
                        abundance: $('input:text[id=id_abundance]').val()
                    },
                    success: function(ldata){
                        console.log(ldata);
                        if (typeof(ldata)==="string") ldata=$.parseJSON(ldata);
                        var result = ldata.activation;
                        var sample = ldata.sample;
                        result.total.splice(0,0,"total activity","","",""); //for a final column
                        result.activity.push(result.total);
                        var data={}
                        //construct headers
                        data.headers=["element","daughter","reaction","half life","activity (0 hrs)","activity (1 hr)", "activity (24 hrs)", "activity (15 days)", result.rest[4]+" (hours)"]
                        data.rows=[]
                        for (var i=0; i < result.activity.length; i++){
                            active = false;
                            for (var j=4; j < result.activity[i].length; j++){
                                active = active || (result.activity[i][j] >= CUTOFF);
                            }
                            if (active) data.rows.push(result.activity[i]);
                        }

                        var content = '<h3>'+sample.mass+' g of '+sample.formula+' for '+result.exposure+' h</h3>\n';
                        if (data.rows.length > 0) {
                            //add headers to table
                            content += '<table border=1>\n';
                            content += ' <tr class="header">';
                            for (var i in data.headers) {
                                content += '<th style=""><a href="#" class="sort"><span>' + data.headers[i] + '</span></a></th>';
                            }
                            content += '</tr>\n'
                            for (var i in data.rows) {
                                content += ' <tr id="' + i + '">';
                                for (var j=0; j <data.rows[i].length; j++){
                                    if (j>=4 && data.rows[i][j] < CUTOFF) { 
                                        content += '<td>---</td>';
                                    } else {
                                        content += '<td>' + data.rows[i][j] + '</td>';
                                    }
                                }
                                content += '</tr>\n';
                            }
                            content += '</table>\n';
                       } else {
                            content += '<p>No activation above '+CUTOFF+' uCi</p>';
                       }

                        $(content).prependTo('div[id=results]'); //add to the dom
                    }
                });
            });
        });
    </script>

    <!--<script type="text/javascript" src="/static/lib/activation.js"></script>-->


</head>
<body>
<div class="container">
   
    <div id="activation_form">

        <form  id="id-activationForm" class="blueForms" method="post" >
            <div style='display:none'><input type='hidden' name='csrfmiddlewaretoken' value='cgmJug2PAM5TlxMPTcM2Q3nFmFR24giG' /> </div>
            <div id="div_id_chemical_formula" class="control-group">
               <label for="id_chemical_formula" class="control-label requiredField">Chemical Formula<span class="asteriskField">*</span></label>
               <div class="controls"><input id="id_chemical_formula" type="text" class="textinput textInput" name="chemical_formula" maxlength="80" value="Co" /> </div>
            </div>
            <div id="div_id_mass" class="control-group">
               <label for="id_mass" class="control-label requiredField">Mass (g)<span class="asteriskField">*</span></label>
               <div class="controls"><input id="id_mass" type="text" class="textinput textInput" name="mass" value="10" /></div>
            </div>
            <div id="div_id_time_on" class="control-group">
               <label for="id_time_on" class="control-label requiredField">Time on Beam (hours)<span class="asteriskField">*</span></label>
               <div class="controls"><input id="id_time_on" type="text" class="textinput textInput" name="time_on" value="10" /> </div>
            </div>
            <div id="div_id_time_off" class="control-group">
               <label for="id_time_off" class="control-label requiredField">Time off Beam (hours)<span class="asteriskField">*</span></label>
               <div class="controls"><input id="id_time_off" type="text" class="textinput textInput" name="time_off" value="200" /> </div>
            </div>
            <div id="div_id_flux" class="control-group">
               <label for="id_flux" class="control-label requiredField">Instrument Flux (n/cm^2/s)<span class="asteriskField">*</span></label>
              <div class="controls"><input id="id_flux" type="text" class="textinput textInput" name="flux" value="100000" /> </div>
            </div>
            <div id="div_id_abundance" class="control-group">
               <label for="id_abundance" class="control-label requiredField">Abundance (IAEA or NIST)<span class="asteriskField">*</span></label>
               <div class="controls"><input id="id_abundance" type="text" class="textinput textInput" name="abundance" value="NIST" /> </div>
            </div>
            <div class="form-actions"><input type="submit" name="submit" value="Submit" class="btn btn-primary" id="submit-id-submit" /> </div>
        </form>

    </div>
    <div id="results">
        <!-- <table id="results_table" border=1> </table> -->
    </div>

</div>
</body>
</html>
